# Exercise 4. Procrustes distance and alignment - Solutions

###### tags: `exercise solutions`



Problems as listed in [Exercise 4](https://hackmd.io/@ColbyBI377/exercise4_Procrustes) appear below indented. 

### Problem 1

> How many specimens are present in the `Bombus.forewings` dataset? 

There are several ways to find this information.


```R
dim(Bombus.forewings$coords)

Bombus.forewings$specimen.number

Bombus.forewings$provenance$create.tps
```

There are 99 specimens

> What species are included? 

```R
unique(Bombus.forewings$metadata$species)
```

```
# [1] "vag"   "imp"   "bimac" "terri" "tern"  "bor"   "ferv"  "san" 
```

#### Challenge 1

> And how many specimens represent each species? (Hint: You could simply count each, but that would be tedious. The goal here is a computational solution. Try looking into the use of the R function `by`. )

```R
c(with(Bombus.forewings$metadata, by(species,species,length)))
```

```
# bimac   bor  ferv   imp   san  tern terri   vag 
#    23     3     2    29     1    26     2    13 
```

### Problem 2

> Perform generalized Procrustes alignment of the `Bombus.forewings` dataset, using the methods and tools we discussed. Be aware that some data curation may be necessary. Use your discretion and check whether it is necessary to omit or reflect specimens, or to correct landmark errors made during digitization. Be sure to document any manual corrections in the data provenance. 
>
> In your response to these questions, include an image of the aligned landmarks (the plot with gray and black dots generated by the `align.procrustes` function) and the data provenance (in markdown format) for the GPA step and any steps of data curation. 

Always useful to look at the data first.

```R
landmark.plot(Bombus.forewings, links = fw.links)
```

Ensure that they're all oriented the same way.

```R
wings <- align.reflect(Bombus.forewings, top.pt = 2, left.pt = 19, links = fw.links)

gpa <- align.procrustes(wings)
```


The initial plot shows at least one dramatic outlier.

```R
gpa <- align.procrustes(wings, outlier.analysis = TRUE)
landmark.plot(wings, links = fw.links, specimen.number = c(1,57))
```

Specimen 57 looks very weird. Not sure how, so it's best to just remove it.

<img src="https://i.imgur.com/0zCz7k0.png" style="zoom:40%;" />

The data provenance should document these steps.

```R
cat(gpa$provenance$align.reflect)
cat(gpa$provenance$align.procrustes)
```

```
## Reflection alignment

Performed by user `drangeli` with `borealis::align.reflect` version 2022.10.20 on Thursday, 20 October 2022, 22:14:28

- top.pt = 2
- bottom.pt = 20
- left.pt = 19
- right.pt = 1

Specimens re-oriented: 98

## Generalized Procrustes analysis

Performed by user `drangeli` with `borealis::align.procrustes` version 2022.10.20 on Thursday, 20 October 2022, 22:19:07

The following 1 specimens were removed after 1 rounds of outlier analysis: 
- FJ190828-002
```

### Problem 3

> Use the function `procrustes.distance` to compare the shapes of the first 3 specimens in the `Bombus.forewings` dataset, after Procrustes alignment. Which two specimens are most similar?

```R
procrustes.distance(gpa$gdf$coords[,,1], gpa$gdf$coords[,,2])
procrustes.distance(gpa$gdf$coords[,,2], gpa$gdf$coords[,,3])
procrustes.distance(gpa$gdf$coords[,,1], gpa$gdf$coords[,,3])
```

Specimens 2 and 3 are most similar.

#### Challenge 3

> We discussed some of the considerations in choosing landmarks. The function `procrustes.jackknife` will test how variation in the location of each landmark affects the outcome of Procrustes alignment. It does this by one-by-one removing landmarks from the dataset and repeating GPA. After each iteration, the median pairwise Procrustes distance among all specimens is determined. The results are output as a table and a plot. (You can include an argument to `links` in this function too.)
>
> Run this function on your curated coordinate data from `Bombus.forewings` (not on the GPA-aligned data). Include the resulting image in your answer. Which landmarks are more variable? What explanations exist for these results?

```R
procrustes.jackknife(wings, links = fw.links)
```

<img src="https://i.imgur.com/7xv5N5x.png" style="zoom:50%;" />

Removal of landmarks 5 and 17 results in the lowest median Procrustes distances. This might reflect human error or variation among digitizers in the placement of those landmarks. However, it could be that landmarks 5 and 17 vary most among the species in the dataset.

---

## Quick Links

- [BI377 Moodle](https://moodle.colby.edu/course/view.php?id=25474)
- [BI377 HackMD](https://hackmd.io/@ColbyBI377/landingpage)
- [BI377 Rstudio VM](https://bi377.colby.edu/)

